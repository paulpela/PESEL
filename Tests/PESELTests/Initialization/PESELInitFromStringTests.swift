//
//  File.swift
//  
//
//  Created by Pawe≈Ç Pela on 16/06/2021.
//

import XCTest
@testable import PESEL

final class PESELInitFromStringTests: XCTestCase {
    func testInitializesFromValidStringWithoutError() {
        for validNumber in validTestNumbers {
            XCTAssertNoThrow(try PESEL(validNumber))
            XCTAssertNotNil(try? PESEL(validNumber))
        }
    }
    
    func testFailsToInitializeForInvalidStringWithError() {
        let invalidStrings = [
            "",
            "invalid",
            "123",
            "1234",
            "ü§¶‚Äç‚ôÇÔ∏è",
            "ü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÇÔ∏è",
            "-1234567",
            "123456789011",
            "11 chars..."
        ]
        
        for invalidString in invalidStrings {
            XCTAssertThrowsError(try PESEL(invalidString), "Did not throw error for \(invalidString)")
        }
    }
    
    func testFailsToInitializeForInvalidMonthWithError() {
        let invalidNumbers = [
            "73000815658",
            "73993815658",
            "73143815658",
            "73163815658",
            "73333815658",
            "73533815658",
            "73733815658",
            "73933815658",
            "73953815658",
        ]
        
        for invalidNumber in invalidNumbers {
            XCTAssertThrowsError(try PESEL(invalidNumber), "Did not throw error for \(invalidNumber)")
        }
    }
    
    func testFailsToInitializeForInvalidDayWithError() {
        let invalidTestNumbers = [
            73013215658,
            92113478766,
            83045644385,
            80038699621,
            90117578893,
            85123888763,
            50060047112,
            93074343891,
            62109883818,
            61049993689,
            87088832478,
        ].map { String($0) }
        
        for invalidNumber in invalidTestNumbers {
            XCTAssertThrowsError(try PESEL(invalidNumber), "Did not throw error for \(invalidNumber)")
        }
    }
    
    func testFailsToInitializeForInvalidDayInMonthWithError() {
        let invalidTestNumbers = [
            73023015658,
            73023115658,
            73043115658,
            73063115658,
            73093115658,
            73113115658,
            73223015658,
            73223115658,
            73243115658,
            73263115658,
            73293115658,
            73313115658,
            73423015658,
            73423115658,
            73443115658,
            73463115658,
            73493115658,
            73513115658,
            73623015658,
            73623115658,
            73643115658,
            73663115658,
            73693115658,
            73713115658,
            73823015658,
            73823115658,
            73843115658,
            73863115658,
            73893115658,
            73913115658,
        ].map { String($0) }
        
        for invalidNumber in invalidTestNumbers {
            XCTAssertThrowsError(try PESEL(invalidNumber), "Did not throw error for \(invalidNumber)")
        }
    }
    
    func testFailsToInitializeForInvalidDayInFebruaryWithError() {
        let invalidTestNumbers = [
            25222915658,
            11022915658,
            21022915658,
            11422915658,
            21422915658,
            11622915658,
            21622915658,
            11822915658,
            21822915658,
        ].map { String($0) }
        
        for invalidNumber in invalidTestNumbers {
            XCTAssertThrowsError(try PESEL(invalidNumber), "Did not throw error for \(invalidNumber)")
        }
    }
    
    func testFailsToInitializeWhenInvalidChecksumWithError() {
        let invalidTestNumbers = [
            73010815655,
            92111278764,
            83040744382,
            80030699620,
            90111578891,
            85122888761,
            50061147115,
            93071943897,
            62100383810,
            61041593681,
            87082532473,
            86011469884,
            84102398995,
            67041312157,
            60101642379,
            72090391171,
            57080168482,
            78051416753,
            67071772134,
            47121868645,
        ].map { String($0) } + [
            "04261644566",
            "00323074882",
            "03310787590",
            "05282158481",
            "02320516473",
            "03273086166",
            "03212254469",
        ]
        
        for invalidNumber in invalidTestNumbers {
            XCTAssertThrowsError(try PESEL(invalidNumber), "Did not throw error for \(invalidNumber)")
        }
    }
    
    let validTestNumbers = [
        73111816477,
        80012056279,
        54031785799,
        64040822765,
        81051153329,
        51052726457,
        60020586612,
        76061776648,
        52060713239,
        71012061664,
        70111783149,
        92081519887,
        48072928127,
        74110321423,
        53121248325,
        92051422432,
        71101264442,
        56011023761,
        81010987578,
        82122219449,
        46121526177,
        83040836824,
        94012575511,
        93062247467,
        67121929289,
        98041739823,
        90032446916,
        55111596148,
        65060345836,
        98050521523,
        78080953381,
        81041383338,
        76052116622,
        77061611591,
        62032962613,
        54060829796,
        55042716413,
        79032192294,
        99090489554,
        98061374848,
        76072428118,
        57091427386,
        49102948393,
        79110157153,
        87120931887,
        53021311835,
        80112321125,
        51062398125,
        75051153762,
        93072433267,
        82051472834,
        53011653273,
        59062473912,
        52031535277,
        84050294116,
        84010771323,
        82072941243,
        65020686935,
        70122318831,
        80102477146,
        95031148296,
        55100714887,
        49013058536,
        62020486916,
        61052939852,
        96022258536,
        71021512339,
        94061895224,
        98020792151,
        75072967353,
        65071175374,
        46041953613,
        55031017163,
        68042994617,
        65071271421,
        70032387242,
        93033199715,
        62121239431,
        50090637194,
        50010171739,
        99112051842,
        47071914926,
        79010167535,
        76100511977,
        95101767156,
        69071581386,
        46101658593,
        96011714542,
        73010815658,
        92111278766,
        83040744385,
        80030699621,
        90111578893,
        85122888763,
        50061147112,
        93071943891,
        62100383818,
        61041593689,
        87082532478,
        86011469887,
        84102398991,
        67041312156,
        60101642378,
        72090391173,
        57080168487,
        78051416758,
        67071772131,
        47121868643,
        96070736172,
        70102364731,
        72082884649,
        91042754152,
        68010566826,
        90080526747,
        92122874979,
        47082914728,
        59093029849,
        77051331847,
        59082151427,
        86040471183,
        65042125412,
        52072014155,
        89011098833,
        76112454639,
        84010926815,
        91050737282,
        66011664765,
        97010179589,
        65061377119,
        82073195696,
        46090165564,
        54010876564,
        96070133788,
        73011849445,
        77090297191,
        53101686529,
        80031555535,
        94081756624,
        68012326651,
        66071844646,
        69110888313,
        69062187252,
        84080858649,
        93032536195,
        63091617449,
        49111672663,
        71012172719,
        62072885213,
        74112264344,
        55033077596,
        63042531385,
        99061725641,
        62030731567,
        98070558286,
        83112325878,
        53031869193,
        59093097664,
        89061214643,
        70051415621,
        83121867831,
        66090578542,
        87123122367,
        59122555464,
        92061591492,
        48121152956,
        57082064125,
        61111861924,
        62112537728,
        58042577877,
        69050858841,
        86072523942,
        90011974795,
        55072892826,
        90011531174,
        75032473476,
        92061692537,
        46090134625,
        72121725995,
        53081344192,
        63051521711,
        92081739757,
        46042887991,
        65051611658,
        85030469593,
        57012285389,
        72073152883,
        72041319935,
        51041576137,
        55083015126,
        74102547716,
    ].map { String($0) } + [
        "04261644564",
        "00323074881",
        "03310787599",
        "05282158489",
        "02320516474",
        "03273086162",
        "03212254467",
        "05322599241",
        "04220764731",
        "02303089164",
        "01312064656",
        "04230489619",
        "01280355941",
        "03260412242",
        "01312691159",
        "02321938974",
        "01252089245",
        "04321652618",
        "05232787477"
    ]
}
